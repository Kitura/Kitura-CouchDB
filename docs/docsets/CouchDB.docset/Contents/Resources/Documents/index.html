<!DOCTYPE html>
<html lang="en">
  <head>
    <title>CouchDB  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="CouchDB  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          CouchDB Docs
        </a>
         (100% documented)
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/IBM-Swift/Kitura-CouchDB/">
            <img class="header-icon" src="img/gh.png"/>
            View on GitHub
          </a>
        </p>
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">CouchDB Reference</a>
      <img class="carat" src="img/carat.png" />
      CouchDB  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/CouchDBClient.html">CouchDBClient</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Database.html">Database</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Database/StaleOptions.html">– StaleOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Database/QueryParameters.html">– QueryParameters</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/Document.html">Document</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/AllDatabaseDocuments.html">AllDatabaseDocuments</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BulkDocuments.html">BulkDocuments</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BulkResponse.html">BulkResponse</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ConnectionProperties.html">ConnectionProperties</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/CouchDBError.html">CouchDBError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/DesignDocument.html">DesignDocument</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/DocumentResponse.html">DocumentResponse</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content">
            
            <p align="center">
    <a href="http://kitura.io/">
        <img src="https://raw.githubusercontent.com/IBM-Swift/Kitura/master/Sources/Kitura/resources/kitura-bird.svg?sanitize=true" height="100" alt="Kitura">
    </a>
</p>

<p align="center">
    <a href="https://ibm-swift.github.io/Kitura-CouchDB/index.html">
    <img src="https://img.shields.io/badge/apidoc-KituraCouchDB-1FBCE4.svg?style=flat" alt="APIDoc">
    </a>
    <a href="https://travis-ci.org/IBM-Swift/Kitura-CouchDB">
    <img src="https://travis-ci.org/IBM-Swift/Kitura-CouchDB.svg?branch=master" alt="Build Status - Master">
    </a>
    <img src="https://img.shields.io/badge/os-macOS-green.svg?style=flat" alt="macOS">
    <img src="https://img.shields.io/badge/os-linux-green.svg?style=flat" alt="Linux">
    <img src="https://img.shields.io/badge/license-Apache2-blue.svg?style=flat" alt="Apache 2">
    <a href="http://swift-at-ibm-slack.mybluemix.net/">
    <img src="http://swift-at-ibm-slack.mybluemix.net/badge.svg" alt="Slack Status">
    </a>
</p>
<h1 id='kitura-couchdb' class='heading'>Kitura-CouchDB</h1>

<p>Kitura-CouchDB is a pure Swift client which allows Kitura applications to interact with a CouchDB or Cloudant database.</p>
<h2 id='usage' class='heading'>Usage</h2>
<h4 id='add-dependencies' class='heading'>Add dependencies</h4>

<p>Add the <code>Kitura-CouchDB</code> package to the dependencies within your application’s <code>Package.swift</code> file. Substitute <code>&quot;x.x.x&quot;</code> with the latest <code>Kitura-CouchDB</code> <a href="https://github.com/IBM-Swift/Kitura-CouchDB/releases">release</a>.</p>
<pre class="highlight swift"><code><span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/IBM-Swift/Kitura-CouchDB.git"</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="s">"x.x.x"</span><span class="p">)</span>
</code></pre>

<p>Add <code>CouchDB</code> to your target&rsquo;s dependencies:</p>
<pre class="highlight swift"><code><span class="o">.</span><span class="nf">target</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"example"</span><span class="p">,</span> <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span><span class="s">"CouchDB"</span><span class="p">]),</span>
</code></pre>
<h4 id='import-package' class='heading'>Import package</h4>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">CouchDB</span>
</code></pre>
<h2 id='run-kitura-couchdb-sample' class='heading'>Run Kitura-CouchDB Sample</h2>

<p>To run the CouchDB Sample, you must set up and connect to a local CouchDB database by following the steps below:</p>

<ol>
<li><p><a href="http://couchdb.apache.org/#download">Download and install CouchDB.</a></p></li>
<li><p>Set up an admin username and password in CouchDB.</p></li>
<li><p>Create a database with the name <code>kitura_test_db</code>.</p></li>
<li><p>Clone this repository:</p>
<pre class="highlight shell"><code>git clone https://github.com/IBM-Swift/Kitura-CouchDB.git
</code></pre></li>
<li><p>Update the following code in <code>Sources\CouchDBSample\main.swift</code> with your admin username and password (the host will default to 127.0.0.1 and the port will default to 5984):</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">connProperties</span> <span class="o">=</span> <span class="kt">ConnectionProperties</span><span class="p">(</span>
    <span class="nv">host</span><span class="p">:</span> <span class="n">host</span><span class="p">,</span>         <span class="c1">// http address</span>
    <span class="nv">port</span><span class="p">:</span> <span class="n">port</span><span class="p">,</span>         <span class="c1">// http port</span>
    <span class="nv">secured</span><span class="p">:</span> <span class="n">secured</span><span class="p">,</span>   <span class="c1">// https or http</span>
    <span class="nv">username</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span>      <span class="c1">// admin username</span>
    <span class="nv">password</span><span class="p">:</span> <span class="kc">nil</span>       <span class="c1">// admin password</span>
<span class="p">)</span>
</code></pre></li>
<li><p>Open a Terminal window, change into the <code>Kitura-CouchDB</code> folder and run <code>swift build</code>:</p>
<pre class="highlight shell"><code>swift build
</code></pre></li>
<li><p>Run the CouchDBSample executable:</p>
<pre class="highlight shell"><code>.build/debug/CouchDBSample
</code></pre>

<p>You should see informational messages such as <q>Successfully created the following JSON document in CouchDB:</q> for each of the operations (create, read, update and delete) performed on the <code>kitura_test_db</code> database.</p></li>
</ol>
<h2 id='api-documentation' class='heading'>API Documentation</h2>
<h4 id='document' class='heading'>Document</h4>

<p>CouchDB is a NoSQL database for storing documents. A <code><a href="Protocols/Document.html">Document</a></code> is any structure that can be represented as JSON and contains <code>_id</code> and <code>_rev</code> fields.  </p>

<ul>
<li>The <code>_id</code> field is the unique identifier for the document. If it is not set, a random UUID will be assigned for the document.<br></li>
<li>The <code>_rev</code> field is the revision of the document. It is returned when you make requests and is used to prevent conflicts from multiple users updating the same document.<br></li>
</ul>

<p>To define a CouchDB document, create a Swift object and make it conform to the <code><a href="Protocols/Document.html">Document</a></code> protocol:</p>
<pre class="highlight swift"><code> <span class="kd">struct</span> <span class="kt">MyDocument</span><span class="p">:</span> <span class="kt">Document</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">_id</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">_rev</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>
</code></pre>
<h4 id='couchdbclient' class='heading'>CouchDBClient</h4>

<p>The <code><a href="Classes/CouchDBClient.html">CouchDBClient</a></code> represents a connection to a CouchDB server. It is initialized with your <code><a href="Structs/ConnectionProperties.html">ConnectionProperties</a></code> and handles the creation, retrieval and deletion of CouchDB databases.</p>
<pre class="highlight swift"><code><span class="c1">// Define ConnectionProperties</span>
<span class="k">let</span> <span class="nv">conProperties</span> <span class="o">=</span> <span class="kt">ConnectionProperties</span><span class="p">(</span>
    <span class="nv">host</span><span class="p">:</span> <span class="s">"127.0.0.1"</span><span class="p">,</span>              <span class="c1">// http address</span>
    <span class="nv">port</span><span class="p">:</span> <span class="mi">5984</span><span class="p">,</span>                     <span class="c1">// http port</span>
    <span class="nv">secured</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>                 <span class="c1">// https or http</span>
    <span class="nv">username</span><span class="p">:</span> <span class="s">"&lt;CouchDB-username&gt;"</span><span class="p">,</span> <span class="c1">// admin username</span>
    <span class="nv">password</span><span class="p">:</span> <span class="s">"&lt;CouchDB-password&gt;"</span>  <span class="c1">// admin password</span>
<span class="p">)</span>
<span class="c1">// Initialize CouchDBClient</span>
<span class="k">let</span> <span class="nv">couchDBClient</span> <span class="o">=</span> <span class="kt">CouchDBClient</span><span class="p">(</span><span class="nv">connectionProperties</span><span class="p">:</span> <span class="n">conProperties</span><span class="p">)</span>
</code></pre>

<ul>
<li>Create a new database</li>
</ul>
<pre class="highlight swift"><code><span class="n">couchDBClient</span><span class="o">.</span><span class="nf">createDB</span><span class="p">(</span><span class="s">"NewDB"</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">database</span> <span class="o">=</span> <span class="n">database</span> <span class="p">{</span>
        <span class="c1">// Use database</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<ul>
<li>Get an existing database</li>
</ul>
<pre class="highlight swift"><code><span class="n">couchDBClient</span><span class="o">.</span><span class="nf">retrieveDB</span><span class="p">(</span><span class="s">"ExistingDB"</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">database</span> <span class="o">=</span> <span class="n">database</span> <span class="p">{</span>
        <span class="c1">// Use database</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<ul>
<li>Delete a database</li>
</ul>
<pre class="highlight swift"><code><span class="n">couchDBClient</span><span class="o">.</span><span class="nf">deleteDB</span><span class="p">(</span><span class="s">"ExistingDB"</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
        <span class="c1">// Handle the error</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h4 id='database' class='heading'>Database</h4>

<p>The <code><a href="Classes/Database.html">Database</a></code> class is used to make HTTP requests to the corresponding CouchDB database. This class can make CRUD (Create, Retrieve, Update, Delete) requests for:</p>

<ul>
<li>A single CouchDB <code><a href="Protocols/Document.html">Document</a></code></li>
<li>An array of CouchDB documents</li>
<li>A CouchDB <code><a href="Structs/DesignDocument.html">DesignDocument</a></code></li>
<li>A <code><a href="Protocols/Document.html">Document</a></code> attachment</li>
</ul>

<p>The following code demonstrates the CRUD operations for a single <code><a href="Protocols/Document.html">Document</a></code>:  </p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">myDocument</span> <span class="o">=</span> <span class="kt">MyDocument</span><span class="p">(</span><span class="nv">_id</span><span class="p">:</span> <span class="s">"Kitura"</span><span class="p">,</span> <span class="nv">_rev</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="s">"Hello World"</span><span class="p">)</span>
</code></pre>

<ul>
<li>Create a Document:<br></li>
</ul>
<pre class="highlight swift"><code><span class="n">database</span><span class="o">.</span><span class="nf">create</span><span class="p">(</span><span class="n">myDocument</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">response</span> <span class="o">=</span> <span class="n">response</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Document: </span><span class="se">\(</span><span class="n">response</span><span class="o">.</span><span class="n">id</span><span class="se">)</span><span class="s">, created with rev: </span><span class="se">\(</span><span class="n">response</span><span class="o">.</span><span class="n">rev</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<ul>
<li>Retrieve a Document:<br></li>
</ul>
<pre class="highlight swift"><code><span class="n">database</span><span class="o">.</span><span class="nf">retrieve</span><span class="p">(</span><span class="s">"Kitura"</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="nv">document</span><span class="p">:</span> <span class="kt">MyDocument</span><span class="p">?,</span> <span class="nv">error</span><span class="p">:</span> <span class="kt">CouchDBError</span><span class="p">?)</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">document</span> <span class="o">=</span> <span class="n">document</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Retrieved document with value: </span><span class="se">\(</span><span class="n">document</span><span class="o">.</span><span class="n">value</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<ul>
<li>Update a Document:<br></li>
</ul>
<pre class="highlight swift"><code><span class="n">myDocument</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s">"New Value"</span>
<span class="n">database</span><span class="o">.</span><span class="nf">update</span><span class="p">(</span><span class="s">"Kitura"</span><span class="p">,</span> <span class="nv">rev</span><span class="p">:</span> <span class="s">"&lt;latest_rev&gt;"</span><span class="p">,</span> <span class="nv">document</span><span class="p">:</span> <span class="n">myDocument</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">response</span> <span class="o">=</span> <span class="n">response</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Document: </span><span class="se">\(</span><span class="n">response</span><span class="o">.</span><span class="n">id</span><span class="se">)</span><span class="s">, updated"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<ul>
<li>Delete a Document:<br></li>
</ul>
<pre class="highlight swift"><code><span class="n">database</span><span class="o">.</span><span class="nf">delete</span><span class="p">(</span><span class="s">"Kitura"</span><span class="p">,</span> <span class="nv">rev</span><span class="p">:</span> <span class="s">"&lt;latest_rev&gt;"</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">if</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Document successfully deleted"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>For more information visit our <a href="https://ibm-swift.github.io/Kitura-CouchDB/index.html">API reference</a>.</p>
<h2 id='community' class='heading'>Community</h2>

<p>We love to talk server-side Swift, and Kitura. Join our <a href="http://swift-at-ibm-slack.mybluemix.net/">Slack</a> to meet the team!</p>
<h2 id='license' class='heading'>License</h2>

<p>This library is licensed under Apache 2.0. Full license text is available in <a href="https://github.com/IBM-Swift/Kitura-CouchDB/blob/master/LICENSE.txt">LICENSE</a>.</p>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2019 <a class="link" href="" target="_blank" rel="external">IBM</a>. All rights reserved. (Last updated: 2019-03-18)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.1</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
